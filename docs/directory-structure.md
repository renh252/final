# 目錄結構說明

> 📁 **重要提示**: 本文檔描述了專案的目錄組織規範。錯誤的目錄結構會導致依賴混亂、權限問題和維護困難。

## 系統架構概覽

寵物領養平台採用分層架構設計，清晰分離了不同類型的代碼：

```
專案架構
┌───────────────────────┐
│      前端頁面層       │ ← app/(routes)/ 和 app/admin/(routes)/
├───────────────────────┤
│      UI組件層        │ ← app/_components/ 和 app/admin/_components/
├───────────────────────┤
│      業務邏輯層       │ ← app/_lib/ 和 app/admin/_lib/
├───────────────────────┤
│      API路由層        │ ← app/api/
├───────────────────────┤
│      共享基礎層       │ ← app/lib/
└───────────────────────┘
```

**依賴關係規則**:

1. 上層可以依賴下層，但下層不能依賴上層
2. 同層之間可以相互依賴，但應盡量減少耦合
3. 共享基礎層不能依賴任何其他層

## 主要目錄用途

### `app/lib/`

此目錄包含整個應用程序的共用基礎庫和工具函數：

- 通用資料庫連接和查詢功能
- 共用工具函數（如樣式管理、日期處理等）
- 基礎配置和常量
- 類型定義

特點：

- 提供基礎設施級別的功能
- 可被任何其他模組引用
- 不包含業務邏輯
- 著重於可重用性和通用性

> **嚴格規範**:
>
> - 此目錄中的代碼不得包含 UI 組件或特定業務邏輯
> - 不得從此目錄直接訪問 API 或前端狀態
> - 不得在此目錄中包含環境特定配置

### `app/api/admin/_lib/`

此目錄專門用於後台管理相關的功能：

- 管理員特定的資料庫操作
- 權限驗證和授權
- 數據導入導出功能
- 管理員專用的工具函數

特點：

- 僅服務於後台管理功能
- 包含管理員特定的業務邏輯
- 可以依賴 app/lib 中的基礎功能
- 需要額外的安全性考慮

> **實現要求**:
>
> - 所有管理員相關的數據庫操作必須經過權限檢查
> - 敏感操作必須記錄完整日誌
> - 不得繞過 API 路由層直接從前端訪問此目錄

## 使用原則

1. 新功能開發時的選擇原則：

   - 如果是通用功能，放在 `app/lib/`
   - 如果是管理員專用功能，放在 `app/api/admin/_lib/`
   - 前端 UI 組件放在 `app/_components/` 或 `app/admin/_components/`
   - API 路由放在相應的 `app/api/` 子目錄中

2. 代碼依賴原則：

   - `app/lib/` 不應該依賴 `app/api/admin/_lib/`
   - `app/api/admin/_lib/` 可以依賴 `app/lib/`
   - 前端組件可以依賴 `app/lib/` 但不應直接依賴 `app/api/admin/_lib/`

3. 安全性原則：
   - `app/api/admin/_lib/` 中的功能必須進行權限驗證
   - 敏感數據和操作必須通過 API 路由層，而非直接在前端調用庫函數

> **開發建議**:
>
> - 創建新文件前，先確認適合的目錄位置
> - 遇到跨層依賴需求時，考慮重構而非破壞架構
> - 避免重複實現已有功能，優先尋找並複用現有代碼

## 目錄內容

### app/lib/

- `db.ts`: 資料庫連接和查詢的基礎設施
- `utils.ts`: 通用工具函數

### app/api/admin/\_lib/

- `auth.ts`: 管理員認證和授權
- `database.ts`: 管理員專用資料庫操作
- `jwt.ts`: JWT 令牌處理
- `member-database.ts`: 會員管理相關操作
- `pet-database.ts`: 寵物資料管理
- `data-export.ts`: 數據導出功能
- `data-import.ts`: 數據導入功能
