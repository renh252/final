# 項目當前狀態與下一步計劃

> 最後更新時間：2024-03-14
>
> 本文檔描述了寵物領養平台的當前開發狀態和下一步計劃。API 結構請參考 [API 結構文檔](api-structure.md)，後台系統架構請參考 [後台管理系統結構文檔](admin-structure.md)。

## 目錄

1. [概述](#概述)
2. [已完成功能](#已完成功能)
3. [進行中功能](#進行中功能)
4. [待開發功能](#待開發功能)
5. [已知問題](#已知問題)
6. [下一步計劃](#下一步計劃)
7. [優先級排序](#優先級排序)

## 概述

本文檔描述了寵物領養平台的當前開發狀態和下一步計劃。項目使用 Next.js 14 (App Router) 開發，包含前台用戶界面和後台管理系統。目前已完成部分核心功能，但仍有許多功能正在開發中或尚未開始開發。

## 已完成功能

### 前台功能

1. **基礎架構**

   - 頁面路由設置
   - 共用元件開發
   - 全局樣式設定
   - 響應式設計基礎

2. **會員系統**

   - 會員註冊和登入
   - 會員資料管理
   - 密碼重設功能
   - 完善的身份驗證系統
     - 支援明碼和哈希密碼驗證
     - 優化用戶狀態處理邏輯
     - JWT 令牌身份驗證機制
     - 安全的 Cookie 設置

3. **寵物領養**

   - 寵物列表展示
   - 寵物詳情頁面
     - [x] 基本信息展示
     - [x] 寵物照片輪播
     - [x] 寵物特質展示
     - [x] 寵物活動記錄顯示
     - [x] 標籤式內容區塊
   - 寵物篩選功能

4. **商城功能**
   - 商品列表展示
   - 商品詳情頁面
   - 購物車基本功能

### 後台功能

1. **基礎架構**

   - [x] 後台頁面佈局
   - [x] 共用元件開發
   - [x] 數據表格元件
   - [x] 模態表單元件
   - [x] 認證機制
   - [x] 權限控制

2. **會員管理**

   - [x] 會員列表展示
   - [x] 會員資料編輯
   - [x] 會員狀態管理
   - [x] 會員資料導入/導出
   - [x] 會員詳情頁面
   - [ ] 會員訂單查看
   - [ ] 會員活動記錄

3. **寵物管理**

   - [x] 寵物列表展示
   - [x] 寵物資料編輯
   - [x] 寵物狀態管理
   - [x] 寵物資料導入/導出
   - [x] 批量操作功能
   - [ ] 寵物相片管理
   - [ ] 領養申請管理

4. **商品管理**

   - [x] 商品列表展示
   - [x] 商品資料編輯
   - [x] 商品狀態管理
   - [x] 商品資料導入/導出
   - [ ] 商品分類管理
   - [ ] 商品庫存管理
   - [ ] 商品評價管理

5. **優惠券管理(待修改成折扣活動管理)**
   - [x] 優惠券列表展示
   - [x] 優惠券資料編輯
   - [x] 優惠券狀態管理
   - [ ] 優惠券使用記錄
   - [ ] 優惠券統計報表

### API 功能

1. **認證 API**

   - [x] 會員登入/登出
   - [x] 管理員登入/登出
   - [x] JWT 認證機制
   - [x] 權限驗證
   - [ ] Token 刷新機制
   - [ ] 密碼重設功能

2. **資料庫連接**
   - [x] MySQL 連接池設置
   - [x] 查詢函數封裝
   - [x] 錯誤處理機制
   - [ ] 查詢優化
   - [ ] 連接池監控

## 進行中功能

### 前台功能

1. **論壇功能**

   - 文章列表展示
   - 文章詳情頁面
   - 評論功能

2. **捐款功能**

   - 捐款活動展示
   - 捐款流程

3. **訂單功能**

   - 結帳流程
   - 訂單追蹤

4. **預約功能**

   - [x] 寵物預約基本流程
   - [x] 預約表單驗證
   - [x] 預約時間段選擇
   - [x] 預約提交與狀態顯示
   - [ ] 預約管理與取消功能 (會員預約管理頁面尚未實現，目前只有 API)
   - [ ] 預約審批通知

5. **寵物問卷推薦系統**
   - [ ] 使用者偏好問卷設計
   - [ ] 基於寵物特徵的匹配算法
   - [ ] 推薦結果展示頁面
   - [ ] 問卷結果儲存功能

### 後台功能

1. **訂單管理**

   - 訂單列表展示
   - 訂單狀態更新
   - 訂單詳情查看

2. **論壇管理**

   - 文章管理
   - 評論管理
   - 檢舉管理

3. **金流管理**
   - 交易紀錄
   - 退款管理
   - 財務報表

### API 功能

1. **商城 API**

   - 訂單 API
   - 支付 API

2. **論壇 API**

   - 文章 API
   - 評論 API

3. **檔案上傳 API**
   - 圖片上傳
   - 檔案處理

## 待開發功能

### 支付系統開發狀態

> **重要說明**: 支付系統目前處於部分開發狀態

| 功能             | 狀態          | 說明                                 |
| ---------------- | ------------- | ------------------------------------ |
| 綠界金流 (ECPay) | 🔄 開發中     | 正在由協作人員開發中，基礎結構已建立 |
| LINE Pay         | 📝 待開發     | 計劃中但尚未開始開發                 |
| 捐款活動功能     | ❌ 不在計劃內 | 文檔中提及但不在當前開發範圍內       |

### 下一階段開發重點（1-2 個月）

### 前台功能

1. **社群功能**

   - 用戶關注
   - 消息通知
   - 私信功能

2. **預約功能**

   - 預約看寵物
   - 預約管理

3. **多語言支持**

   - 中文/英文切換
   - 語言包管理

4. **寵物問卷推薦系統**
   - 問卷資料分析與統計
   - 推薦演算法優化
   - 使用者行為追蹤
   - 推薦準確度評估

### 後台功能

1. **系統設定**

   - 角色權限管理
   - 系統參數設定
   - 系統日誌

2. **數據分析**
   - 用戶行為分析
   - 銷售數據分析
   - 領養數據分析

### API 功能

1. **第三方 API 整合**

   - 社群登入 API
   - 支付 API
   - 地圖 API

2. **推送通知 API**
   - 電子郵件通知
   - 瀏覽器推送通知

## 已知問題

### 1. 用戶身份驗證相關

- ~~用戶狀態為「禁言」時無法登入 - 已修復~~
  - 現在系統支援除「停用」以外的所有狀態用戶登入，並將用戶狀態信息包含在 JWT 令牌中，供前端根據需要實施不同限制。
- ~~登入時嘗試更新不存在的 updated_at 欄位導致 SQL 錯誤 - 已修復~~
  - 已移除相關代碼，若需記錄登入時間，需先擴展資料庫結構。
- 前台授權檢查已暫時禁用，允許所有用戶訪問前台 - 暫時性措施
  - 驗證 API (app/api/auth/verify/route.ts) 已被修改為始終返回成功，此設置僅用於開發或測試。
  - 詳細說明和恢復方法請參閱 [用戶身份驗證實現指南](auth-implementation-guide.md) 第 8 節。
- 密碼存儲目前支援明碼和哈希兩種方式，應考慮在將來全面遷移到哈希密碼存儲模式
- PHP 生成的 bcrypt 哈希（$2y$）與 Node.js 不完全兼容，需要進行替換處理
- 未來需考慮實現令牌刷新機制以提高安全性

2. **前台問題**

   - 移動端響應式設計需要優化
   - 部分頁面加載速度較慢
   - 圖片優化不足

3. **後台問題**

   - [x] 修復 Spinner 組件引用錯誤
   - [x] 修復認證機制問題
   - [ ] 優化資料表格的性能
   - [ ] 完善錯誤處理機制
   - [ ] 添加操作日誌功能

4. **API 問題**

   - [x] 統一認證機制
   - [x] 修復權限驗證問題
   - [x] 修復後台 API 中的 executeQuery 函數缺失問題
     - 問題：在 database.ts 中缺少 executeQuery 函數定義，但多個文件引用了此函數
     - 修復：在 database.ts 中添加了 executeQuery 函數，支援泛型類型並保持與現有用法兼容
     - 影響範圍：影響所有使用此函數的後台 API，包括產品、會員、訂單等管理功能
   - [ ] 優化 API 響應速度
   - [ ] 完善 API 文檔
   - [ ] 添加 API 測試

5. **其他問題**
   - [ ] 缺少自動化測試
   - [ ] 缺少 CI/CD 流程
   - [ ] 缺少性能監控

## 下一步計劃

### 短期計劃（1-2 週）

1. **完善後台功能**

   - [x] 完成會員詳情頁面
   - [ ] 完成訂單管理頁面
   - [ ] 完成商品分類管理頁面
   - [ ] 優化批量操作功能

2. **API 優化**
   - [x] 統一認證機制
   - [x] 完善錯誤處理
   - [ ] 添加 API 文檔
   - [ ] 實現 API 緩存

### 中期計劃（1-2 個月）

1. **前台功能擴展**

   - 完成論壇功能
   - 完成捐款功能
   - 完成預約功能

2. **後台功能擴展**

   - 完成論壇管理
   - 完成金流管理
   - 完成系統設定

3. **第三方整合**
   - 整合社群登入
   - 整合支付 API
   - 整合地圖 API

### 長期計劃（3-6 個月）

1. **功能優化**

   - 優化用戶體驗
   - 優化性能
   - 優化 SEO

2. **新功能開發**

   - 開發社群功能
   - 開發多語言支持
   - 開發數據分析功能

3. **基礎設施**
   - 建立自動化測試
   - 建立 CI/CD 流程
   - 建立性能監控

## 優先級排序

### 高優先級

1. 修復 Spinner 組件引用錯誤
2. 修復資料庫連接問題
3. 將模擬數據替換為真實 API 數據
4. 完成訂單管理頁面
5. 優化移動端響應式設計

### 中優先級

1. 完成商品分類管理頁面
2. 優化批量操作功能
3. 完善錯誤處理機制
4. 完成論壇功能
5. 完成捐款功能

### 低優先級

1. 添加 API 文檔
2. 開發社群功能
3. 開發多語言支持
4. 建立自動化測試
5. 建立 CI/CD 流程

### 代碼風格

- 使用 ESLint 和 Prettier 進行代碼格式化
- 遵循 TypeScript 的類型檢查
- 使用 CSS Modules 和 `app/global.css` 進行樣式管理
