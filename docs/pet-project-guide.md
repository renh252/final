





mysql : 無法辨識 'mysql' 詞彙是否為 Cmdlet、函數、指令檔或可執行程式的名稱。請  
檢查名稱拼字是否正確，如果包含路徑的話，請確認路徑是否正確，然後再試一次。      
位於 線路:1 字元:1
+ mysql -u root -e "SHOW DATABASES;"
+ ~~~~~
    + CategoryInfo          : ObjectNotFound: (mysql:String) [], CommandNotFou  
   ndException
    + FullyQualifiedErrorId : CommandNotFoundException
 
PS C:\Users\User\Desktop\final> cd 'c:\Users\User\Desktop\final'
PS C:\Users\User\Desktop\final> npx ts-node database/init-db.ts
Need to install the following packages:
ts-node@10.9.2
Ok to proceed? (y)# 寵物領養平台導覽文檔

> 版本：1.0
> 最後更新：2025-03-18
> 此文檔整合了專案的核心資訊，為 AI 提供高效參考。
>
> **重要說明**: 本文檔是與 AI 溝通時唯一需要提供的文檔，已整合所有關鍵資訊。

## 1. 專案概述

毛孩之家 是一個綜合性的寵物領養和社區平台，包含以下主要功能：

1. **寵物領養資訊**展示和篩選
2. **社群討論區**（論壇）
3. **寵物用品電子商務**功能
4. **捐款和公益活動**
5. **會員管理系統**
6. **後台管理系統**

### 技術棧

- **前端**: Next.js 14 (App Router), TypeScript, React-Bootstrap, CSS Modules
- **後端**: Next.js API Routes, TypeScript
- **資料庫**: MySQL (mysql2)
- **認證**: JWT (jsonwebtoken), next-auth
- **其他關鍵庫**: js-cookie, axios, react-hook-form, sharp, lucide-react

## 2. 核心功能開發狀態

| 功能領域     | 狀態              | 說明                                                         |
| ------------ | ----------------- | ------------------------------------------------------------ |
| 寵物領養系統 | ✅ 基本功能已完成 | 包含寵物列表、詳情和領養流程                                 |
| 社群討論區   | ✅ 基本功能已完成 | 帖子發布、回覆、點讚等功能                                   |
| 寵物用品商城 | ✅ 基本功能已完成 | 商品管理、購物車、訂單系統                                   |
| 會員管理系統 | ✅ 基本功能已完成 | 註冊、登入、個人資料管理                                     |
| 後台管理系統 | ✅ 基本功能已完成 | 包含權限控制、數據管理功能                                   |
| 預約系統     | ✅ 功能已完成     | 前台會員預約頁面與後台預約管理、日曆視圖、預約詳情查看已實現 |
| 支付系統     | 🔄 開發中         | 綠界金流進行中，LINE Pay 待開發                              |

## 3. 系統架構關鍵要點

### 後台權限系統

- **權限格式**:
  - 超級管理員: `111` (不可修改此格式)
  - 一般管理員: 冒號分隔格式 (如 `members:read`, `shop:products:read`)
- **關鍵組件**:
  - 權限管理模組: `app/admin/_lib/permissions.ts`
  - 管理員側邊欄: `app/admin/components/Sidebar.tsx`
- **權限流程**:
  ```
  權限系統關係圖
  ┌────────────────────┐         ┌───────────────────┐
  │  permissions.ts    │ ◄────── │    Sidebar.tsx    │
  └───────┬────────────┘         └─────────┬─────────┘
          │                                │
          │         ┌───────────────────┐  │
          └────────►│   AdminContext.tsx │◄─┘
                    └────────┬──────────┘
                             │
                    ┌────────▼──────────┐
                    │  verify/route.ts  │
                    └───────────────────┘
  ```

### 認證系統

- **用戶認證流程**:
  ```
  ┌────────────────┐         ┌───────────────────┐
  │ login/route.ts │ ──────► │  jwt.ts (Token)   │
  └───────┬────────┘         └─────────┬─────────┘
          │                             │
          │                             ▼
          │                   ┌───────────────────┐
          └──────────────────►│     auth.ts       │
                              └─────────┬─────────┘
                                        │
                              ┌─────────▼─────────┐
                              │ API 路由 (驗證)    │
                              └───────────────────┘
  ```
- **認證機制**: JWT 令牌，支援明碼和哈希密碼的驗證機制
- **安全要求**: 必須使用 httpOnly 和 secure Cookie 設置

### API 結構與規範

- **路徑規範**: 所有後台 API 位於`app/api/admin`目錄
- **重要規則**:
  - 使用 RESTful 風格設計
  - 權限檢查必須實施
  - 使用統一錯誤處理
  - 前端使用`fetchApi`工具函數
  - 嚴禁在 API 路由中直接編寫 SQL
  - 禁止繞過權限檢查機制

### 資料庫結構

- **關鍵規範**:
  - 不得修改現有主鍵和外鍵關係
  - 所有查詢必須使用參數化查詢
  - 多表操作必須使用事務
  - 必須妥善處理錯誤
- **主要資料表**:
  - `admin_operation_logs`: 管理員操作日誌
  - `bank_transfer_details`: 銀行轉帳詳情
  - `pets`: 寵物列表
  - `bookmarks`: 使用者收藏貼文
  - `cases`: 救援案例
  - `categories`: 商品分類資訊
    (其他表省略)

### 前端組件開發

- **開發規範**:
  - 保持組件的單一職責
  - 使用 TypeScript 定義 Props 和 State 類型
  - 組件樣式必須與現有設計系統一致
  - 修改現有組件時必須保持原有 Props 接口
  - 後台組件必須與權限系統正確集成
- **禁止事項**:
  - 組件內直接修改全局狀態
  - 使用內聯樣式替代統一樣式系統
  - 未處理加載和錯誤狀態
  - 引入新的 UI 框架或樣式系統(如果需要就詢問使用者)

### 預約系統架構

- **前台預約功能**:
  - 會員預約列表: `app/member/appointments/page.tsx`
  - 預約狀態追蹤: 支援四種狀態（待審核、已確認、已完成、已取消）
  - 狀態流程: 會員提交預約 → 管理員審核 → 確認/拒絕 → 完成領養
  - **新增功能**:
    - 日曆視圖: 支援月、週、日三種檢視模式，根據預約狀態顯示不同顏色
    - 預約詳情彈出視窗: 查看預約詳細資訊，可取消待審核的預約
    - 表格/日曆視圖切換: 提供兩種不同的預約查看模式
- **後台預約管理**:

  - 預約管理頁面: `app/admin/pets/appointments/page.tsx`
  - 主要功能:
    - 狀態篩選、搜尋、申請詳情查看、狀態更新
    - 整合 DataTable 元件，支援排序、分頁、批量操作
    - 提供表格和日曆兩種檢視模式
  - 側邊欄整合: 整合在寵物管理選單下，提供快速訪問
  - **新增功能**:
    - DataTable 整合:
      - 支援多欄位排序
      - 內建分頁功能
      - 批量操作（確認/拒絕）
      - 搜尋功能（申請者/寵物名稱）
    - 日曆視圖: 支援月、週、日三種檢視模式，根據預約狀態顯示不同顏色
    - 表格/日曆視圖切換: 提供兩種不同的預約管理方式
    - 預約詳情管理: 在彈出視窗中更新預約狀態

- **關鍵組件**:

  - 前台日曆組件: `app/member/_components/MemberAppointmentCalendar.tsx`
  - 後台日曆組件: `app/admin/_components/FullCalendar.tsx`
  - 後台表格組件: `app/admin/_components/DataTable.tsx`

- **資料模型**:
  - 主要表格: `pet_appointment`
  - 關鍵欄位: 用戶 ID、寵物 ID、預約日期、時間、狀態、居住環境信息等

## 4. 與 AI 溝通指南

### AI 指令模板

#### 新功能開發模板

```
任務：開發[功能名稱]
實施要求：
1. 僅修改[指定檔案]
2. 遵循[設計模式/規範]
3. 確保不影響[現有功能]
4. 實現方案必須與本文檔描述一致
驗證方法：[如何驗證功能正常]
```

#### 功能修復模板

```
問題：[簡述問題]
相關檔案：[檔案路徑]
修復要求：
1. 精確定位問題根源
2. 提出最小範圍修改
3. 不改變現有架構
4. 說明如何驗證修復成功
```

### 開發流程規範

每次開發必須遵循的標準流程：

1. **理解階段**：AI 必須先理解現有架構
2. **設計階段**：提出設計方案，包括修改範圍和實現方式
3. **實施階段**：按小步驟實施，每一步都需包含驗證方法
4. **驗證階段**：提供完整的測試步驟

## 5. 開發規範警告

所有開發活動必須嚴格遵循以下規範和限制：

1. **權限系統**：禁止修改超級管理員「111」權限格式和檢查邏輯
2. **API 實現**：禁止直接在 API 路由中編寫 SQL 語句或繞過權限驗證
3. **資料庫操作**：必須使用參數化查詢和事務管理
4. **目錄結構**：必須遵循分層架構，避免跨層級依賴
5. **UI 開發**：保持組件接口和樣式一致性，避免內聯樣式
6. **身份驗證**：遵循用戶身份驗證的最佳實踐，確保安全性
7. **資料表名稱**：API 必須使用正確的資料表名稱，確保與資料庫結構一致，例如：
   - 使用 `products` 而非 `shop_products`
   - 使用 `orders` 而非 `shop_orders`
   - 使用 `order_items` 而非 `shop_order_items`
   - 使用 `categories` 而非 `shop_categories`

## 6. 功能開發成功標準檢查

### 權限系統修改檢查清單

- [ ] 是否保留超級管理員「111」權限格式支持？
- [ ] 是否維持與現有權限緩存機制兼容？
- [ ] 修改是否僅限於明確指定的檔案範圍？
- [ ] 是否提供了詳細的用戶驗證方法？
- [ ] 是否確保了向後兼容性？

### 身份驗證系統修改檢查清單

- [ ] 是否保留支援明碼和哈希密碼的驗證機制？
- [ ] 是否正確處理不同的用戶狀態（正常/禁言/停用等）？
- [ ] 是否使用參數化查詢避免 SQL 注入？
- [ ] JWT 令牌是否包含必要的用戶資訊？
- [ ] 是否遵循 Cookie 安全設置（httpOnly、secure 等）？

### 前端修改檢查清單

- [ ] 是否保留了現有的主題支持？
- [ ] 是否維持與權限系統的正確整合？
- [ ] 修改是否僅影響 UI 而不影響權限邏輯？
- [ ] 是否兼容不同權限格式？
- [ ] 是否處理了所有加載和錯誤狀態？

## 7. 可選參考文檔

在特定開發需求時，可按需參考以下具體文檔：

- `database-structure.md` - 僅在需要詳細資料庫表格定義和關係時參考
- `api-structure.md` - 僅在開發新 API 端點或修改現有 API 時參考
- `frontend-components.md` - 僅在開發複雜 UI 組件時參考
- `admin-structure.md` - 僅在修改後台核心架構時參考
- `auth-implementation-guide.md` - 僅在調整認證流程時參考
- `db-structure-usage.md` - 僅在處理複雜資料庫查詢時參考
